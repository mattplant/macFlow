# --- MacFlow: UTM / VirtIO Config ---
# 1. Display: Dynamic Resizing (The UTM Advantage)
# "preferred" tells Hyprland to use whatever resolution the UTM window is resized to.
# "auto" positions it automatically.
# "2" scales it for Retina (HiDPI). Change to "1" if you want massive screen real estate.
#monitor=,preferred,auto,2
#monitor = Virtual-1, 3840x2160, auto, 2
monitor = , 3840x2160, auto, 2
#monitor = , 2880x1864, auto, 2

# 2. Input: Mac Feel
input { 
    kb_layout = us
    follow_mouse = 1

    # Natural Scrolling for Trackpad/Mouse
    natural_scroll = true
    touchpad {
         natural_scroll = true
         tap-to-click = true
    }

    # Sensitivity (Optional tweak for VM mouse feel)
    sensitivity = 0
}

# 3. VM Integration (Critical)
# Fix for invisible cursor on VMs
env = WLR_NO_HARDWARE_CURSORS,1

# Use xwayland for copy/paste stability
xwayland {
    force_zero_scaling = true;
}

# Start SPICE Agent for Clipboard & Auto-Resize
exec-once = systemctl --user start spice-vdagent

# 4. Layout: The "Omarchy" Dwindle
general { 
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg 
    col.inactive_border = rgba(595959aa)
    layout = dwindle
}

dwindle {
    pseudotile = true
    preserve_split = true
}


# 5. Performance (Brutalist Mode)
# Disable expensive effects for rock-solid VM performance
decoration {
    rounding = 5
    blur {
        enabled = false
    }
    shadow {
        enabled = false
    }
}

animations {
    enabled = false
}

misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    vfr = true # Variable Frame Rate saves CPU
}

# 6. Keybindings (Mac Style)
$mainMod = SUPER # Maps to Command Key

# Clipboard: Manual Export to macOS
# Press Super+Shift+C to send text to Mac
bind = $mainMod SHIFT, C, exec, ~/.local/bin/clipboard-export

# Applications
bind = $mainMod, RETURN, exec, foot
bind = $mainMod, D, exec, wofi --show drun
bind = $mainMod, B, exec, firefox
bind = $mainMod, C, exec, code

# Window Control
bind = $mainMod, Q, killactive,
bind = $mainMod SHIFT, E, exit,
bind = $mainMod, F, togglefloating, 
bind = $mainMod, P, pseudo,
bind = $mainMod, J, togglesplit,

# Focus (Vim keys)
bind = $mainMod, h, movefocus, l
bind = $mainMod, l, movefocus, r
bind = $mainMod, k, movefocus, u
bind = $mainMod, j, movefocus, d

# Move Windows
bind = $mainMod SHIFT, h, movewindow, l
bind = $mainMod SHIFT, l, movewindow, r
bind = $mainMod SHIFT, k, movewindow, u
bind = $mainMod SHIFT, j, movewindow, d

# Autostart Essentials
# 1. System Services (Notifications & Auth)
exec-once = dunst
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec-once = waybar

# Update Environment (CRITICAL: Must run to populate DBus)
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Host Integration
exec-once = /home/macflow/.local/bin/start-spice

# Mount Mac files (using the function from .bash_profile doesn't work here, use raw command)
# exec-once = sshfs ... (Add your mount command here if you want auto-mount)
