#!/bin/bash
# MacFlow Export Debug Script

export DISPLAY=:0
export WAYLAND_DISPLAY="${WAYLAND_DISPLAY:-wayland-1}"

# 1. Get Wayland Content
CONTENT=$(wl-paste --no-newline 2>/dev/null)

if [ -z "$CONTENT" ]; then
    echo "❌ Wayland Empty"
    exit 1
fi

echo "✅ Content: $CONTENT"

# 2. Pause Watcher
pkill -STOP -f "clipboard-sync"

# 3. Write to X11 (Verbose Mode)
# We write to both PRIMARY and CLIPBOARD to trigger all listeners
echo "Writing to X11..."
echo -n "$CONTENT" | xclip -i -selection clipboard -verbose
echo -n "$CONTENT" | xclip -i -selection primary -verbose

# 4. Wait longer for SPICE to react
sleep 1

# 5. Resume Watcher
pkill -CONT -f "clipboard-sync"
echo "✅ Done"

